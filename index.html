<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Local IP</title>
    <style>
        body { font-family: -apple-system, sans-serif; text-align: center; padding: 50px 20px; }
        h1 { color: #333; }
        #ip-display { 
            font-size: 24px; 
            font-weight: bold; 
            color: #007AFF; 
            margin-top: 20px; 
            word-break: break-all;
        }
        .note { color: #666; font-size: 14px; margin-top: 30px; }
    </style>
</head>
<body>

    <h1>Your Local IP:</h1>
    <div id="ip-display">Detecting...</div>

    <div class="note">
        <p><strong>Note for iPhone Users:</strong><br>
        If you see a long string of random text (e.g., <em>.local</em>) or nothing, Safari is hiding your real IP for privacy.</p>
    </div>

    <script>
        async function getLocalIP() {
            const display = document.getElementById('ip-display');
            
            try {
                const rtc = new RTCPeerConnection({iceServers: []});
                
                // This creates a data channel, which triggers the browser to gather "candidates"
                rtc.createDataChannel('');
                
                // Create an offer to start the connection process
                const offer = await rtc.createOffer();
                await rtc.setLocalDescription(offer);

                rtc.onicecandidate = (event) => {
                    if (event && event.candidate && event.candidate.candidate) {
                        const candidate = event.candidate.candidate;
                        // Regex to extract the IP address from the candidate string
                        const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                        const match = candidate.match(ipRegex);
                        
                        if (match) {
                            display.textContent = match[1];
                            rtc.close(); // Close connection once found
                        } else {
                            // If we find an mDNS address (random-string.local)
                            if (candidate.includes('.local')) {
                                display.textContent = "Hidden by Safari (mDNS ID found)";
                            }
                        }
                    }
                };

                // Timeout if nothing is found after 3 seconds
                setTimeout(() => {
                    if (display.textContent === 'Detecting...') {
                        display.textContent = "Could not detect (Blocked by Browser)";
                    }
                }, 3000);

            } catch (e) {
                display.textContent = "Error: " + e.message;
            }
        }

        getLocalIP();
    </script>

</body>
</html>
